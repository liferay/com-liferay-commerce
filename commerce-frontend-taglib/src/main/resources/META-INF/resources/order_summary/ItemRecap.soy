{namespace ItemRecap}

/**
 * This renders the component's whole content.
 */
{template .render}
	{@param? stage: string}
	{@param? dataChanged: bool}
	{@param? adminPrivileges: bool}
	{@param? itemData: [
		thumbnail: string,
		sku: string,
		name: string,
		tierPricing: ?,
		description: string
	]}
	{@param? formData: [
		deliveryDate: string,
		note: string,
		price: string,
		discount: string,
		giftQuantity: string|int,
		quantity: string|int
	]}
	{@param? _handleTabChange: any}
	{@param? _handleFormSubmit: any}
	{@param? _handleFormUpdate: any}
	{@param? _handleCancelClick: any}

	<div class="item-recap panel-body">
		<div class="commerce-tabs item-recap__tabs">
			<button data-onclick="{$_handleTabChange}" data-element="overview">
				{msg desc="overview"}overview{/msg}
			</button>
			{if $adminPrivileges}
				<button data-onclick="{$_handleTabChange}" data-element="edit">
					{msg desc="edit"}edit{/msg}
				</button>
			{/if}
		</div>
		{if isNonnull($formData) and isNonnull($itemData)}
			<form data-onsubmit="{$_handleFormSubmit}">
				{if $stage == 'edit' and isNonnull($formData) and $adminPrivileges}
					{call .edit}
						{param _handleFormUpdate: $_handleFormUpdate /}
						{param price: $formData.price /}
						{param discount: $formData.discount /}
						{param quantity: $formData.quantity /}
						{param giftQuantity: $formData.giftQuantity /}
					{/call}
				{else}
					{call .overview}
						{param _handleFormUpdate: $_handleFormUpdate /}
						{param thumbnail: $itemData.thumbnail /}
						{param sku: $itemData.sku /}
						{param name: $itemData.name /}
						{param tierPricing: $itemData.tierPricing /}
						{param description: $itemData.description /}
						{param deliveryDate: $formData.deliveryDate /}
						{param note: $formData.note /}
					{/call}			
				{/if}

				{let $cancelClasses kind="text"}
					commerce-button commerce-button--outline
					{if $dataChanged == false}
						{sp}commerce-button--disabled
					{/if}
				{/let}
				{let $saveClasses kind="text"}
					commerce-button
					{if $dataChanged == false}
						{sp}commerce-button--disabled
					{/if}
				{/let}

				<button type="reset" class="{$cancelClasses}" data-onclick="{$_handleCancelClick}">{msg desc="cancel"}cancel{/msg}</button>
				<button type="submit" class="{$saveClasses}">{msg desc="save"}save{/msg}</button>
			</form>
		{else}
			{call .empty /}
		{/if}
	</div>
{/template}

{template .empty}
	<div class="item-recap__empty">
		{msg desc="Please select a product"}please-select-a-product{/msg}
	</div>
{/template}

{template .overview}
	{@param _handleFormUpdate: any}
	{@param deliveryDate: string}
	{@param? description: string}
	{@param name: string}
	{@param? note: string}
	{@param sku: string}
	{@param tierPricing: list<[
		quantity: string|int,
		price: string
	]>}
	{@param thumbnail: string}

	<div class="item-recap__overview">
		<p>{$thumbnail}</p>
		<p>{$sku}</p>
		<p>{$name}</p>

		{let $requestDeliveryDateLabel kind="html"}{msg desc="Request delivery date"}request-delivery-date{/msg}{/let}
		{call CommerceInputText.render}
			{param contextName: 'item-recap' /}
			{param name: 'deliveryDate' /}
			{param label: $requestDeliveryDateLabel /}
			{param value: $deliveryDate /}
			{param type: 'date' /}
			{param required: true /}
			{param keyUpHandler: $_handleFormUpdate /}
		{/call}

		{let $noteLabel kind="html"}{msg desc="Note"}note{/msg}{/let}
		{call CommerceInputText.render}
			{param contextName: 'item-recap' /}
			{param name: 'note' /}
			{param label: $noteLabel /}
			{param value: $note /}
			{param type: 'text' /}
			{param required: true /}
			{param keyUpHandler: $_handleFormUpdate /}
		{/call}

		{if isNonnull($description)}
			<p>{$description}</p>
		{/if}
		
		<dl>
			{foreach $tierDefinition in $tierPricing}
				<dt>
					{$tierDefinition.quantity} {msg desc="units"}units{/msg}
				</dt>
				<dd>
					{$tierDefinition.price}
				</dd>
			{/foreach}
		</dl>
	</div>
{/template}

{template .edit}
	{@param _handleFormUpdate: any}
	{@param discount: string}
	{@param giftQuantity: string|int}
	{@param price: string}
	{@param quantity: string|int}

	<div class="item-recap__edit">

		{let $priceLabel kind="html"}{msg desc="Price"}price{/msg}{/let}
		{call CommerceInputText.render}
			{param contextName: 'item-recap' /}
			{param name: 'price' /}
			{param label: $priceLabel /}
			{param value: $price /}
			{param type: 'text' /}
			{param required: true /}
			{param keyUpHandler: $_handleFormUpdate /}
		{/call}

		{let $discountLabel kind="html"}{msg desc="Discount"}discount{/msg}{/let}
		{call CommerceInputText.render}
			{param contextName: 'item-recap' /}
			{param name: 'discount' /}
			{param label: $discountLabel /}
			{param value: $discount /}
			{param type: 'text' /}
			{param required: true /}
			{param keyUpHandler: $_handleFormUpdate /}
		{/call}

		{let $quantityLabel kind="html"}{msg desc="Quantity"}quantity{/msg}{/let}
		{call CommerceInputText.render}
			{param contextName: 'item-recap' /}
			{param name: 'quantity' /}
			{param label: $quantityLabel /}
			{param value: $quantity /}
			{param type: 'number' /}
			{param required: true /}
			{param keyUpHandler: $_handleFormUpdate /}
		{/call}

		{let $giftLabel kind="html"}{msg desc="Gift quantity"}gift-quantity{/msg}{/let}
		{call CommerceInputText.render}
			{param contextName: 'item-recap' /}
			{param name: 'giftQuantity' /}
			{param label: $giftLabel /}
			{param value: $giftQuantity /}
			{param type: 'number' /}
			{param required: true /}
			{param keyUpHandler: $_handleFormUpdate /}
		{/call}
	</div>
{/template}
